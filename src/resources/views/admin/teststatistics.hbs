<a href='/statis/view'>Xem</a>

{{!-- <form method="GET" action="/statis/auto">
  <label for="year">NƒÉm:</label>
  <select name="year" id="year" onchange="this.form.submit()">
    <option value="all" {{#if (eq selectedYear "all")}}selected{{/if}}>T·∫•t c·∫£</option>
    {{#each availableYears}}
      <option value="{{this}}" {{#if (eq this ../selectedYear)}}selected{{/if}}>{{this}}</option>
    {{/each}}
  </select>

  <label for="mode">Ph√¢n lo·∫°i:</label>
  <select name="mode" id="mode" onchange="this.form.submit()">
    <option value="candidate" {{#if (eq selectedMode "candidate")}}selected{{/if}}>Th·ªëng k√™ ·ª©ng vi√™n</option>
    <option value="event" {{#if (eq selectedMode "event")}}selected{{/if}}>Th·ªëng k√™ s·ª± ki·ªán</option>
    <option value="room" {{#if (eq selectedMode "room")}}selected{{/if}}>Th·ªëng k√™ c∆° s·ªü v·∫≠t ch·∫•t</option>
  </select>

  <label for="type">Lo·∫°i s·ª± ki·ªán:</label>
  <select name="type" id="type" onchange="this.form.submit()">
    <option value="all" {{#if (eq selectedType "all")}}selected{{/if}}>T·∫•t c·∫£</option>
    {{#each types}}
      <option value="{{this._id}}" {{#if (eq this._id ../selectedType)}}selected{{/if}}>{{this.name}}</option>
    {{/each}}
  </select>

  <!-- Lo·∫°i s·ª± ki·ªán: Trong n∆∞·ªõc / Ngo√†i n∆∞·ªõc -->
  <label for="eventType">Lo·∫°i s·ª± ki·ªán:</label>
  <select name="eventType" id="eventType" onchange="this.form.submit()">
    <option value="all" {{#if (eq selectedEventType "all")}}selected{{/if}}>T·∫•t c·∫£</option>
    <option value="Trong n∆∞·ªõc" {{#if (eq selectedEventType "Trong n∆∞·ªõc")}}selected{{/if}}>Trong n∆∞·ªõc</option>
    <option value="Ngo√†i n∆∞·ªõc" {{#if (eq selectedEventType "Ngo√†i n∆∞·ªõc")}}selected{{/if}}>Ngo√†i n∆∞·ªõc</option>
  </select>

  <!-- Ng√¥n ng·ªØ kh√≥a h·ªçc -->
  <label for="courseLanguage">Ng√¥n ng·ªØ:</label>
  <select name="courseLanguage" id="courseLanguage" onchange="this.form.submit()">
    <option value="all" {{#if (eq selectedCourseLanguage "all")}}selected{{/if}}>T·∫•t c·∫£</option>
    <option value="Anh" {{#if (eq selectedCourseLanguage "Anh")}}selected{{/if}}>Anh</option>
    <option value="H√†n Qu·ªëc" {{#if (eq selectedCourseLanguage "H√†n Qu·ªëc")}}selected{{/if}}>H√†n Qu·ªëc</option>
  </select>

  <!-- Tr·∫°ng th√°i -->
  <label for="status">Tr·∫°ng th√°i:</label>
  <select name="status" id="status" onchange="this.form.submit()">
    <option value="all" {{#if (eq selectedStatus "all")}}selected{{/if}}>T·∫•t c·∫£</option>
    <option value="ƒê√£ xu·∫•t b·∫£n" {{#if (eq selectedStatus "ƒê√£ xu·∫•t b·∫£n")}}selected{{/if}}>ƒê√£ xu·∫•t b·∫£n</option>
    <option value="ƒêang th·ª±c hi·ªán" {{#if (eq selectedStatus "ƒêang th·ª±c hi·ªán")}}selected{{/if}}>ƒêang th·ª±c hi·ªán</option>
  </select>

  {{#if (eq selectedMode "candidate")}}

    <!-- Ph√¢n lo·∫°i -->
    <label for="classify">Lo·∫°i th√†nh vi√™n:</label>
    <select name="classify" id="classify" onchange="this.form.submit()">
      <option value="all" {{#if (eq selectedClassify "all")}}selected{{/if}}>T·∫•t c·∫£</option>
      <option value="·ª®ng vi√™n" {{#if (eq selectedClassify "·ª®ng vi√™n")}}selected{{/if}}>·ª®ng vi√™n</option>
      <option value="Ban qu·∫£n l√Ω" {{#if (eq selectedClassify "Ban qu·∫£n l√Ω")}}selected{{/if}}>Ban qu·∫£n l√Ω</option>
    </select>

    <!-- Chuy√™n ng√†nh -->
    <label for="specialized">Chuy√™n ng√†nh:</label>
    <select name="specialized" id="specialized" onchange="this.form.submit()">
      <option value="all" {{#if (eq selectedSpecialized "all")}}selected{{/if}}>T·∫•t c·∫£</option>
      <option value="CN1" {{#if (eq selectedSpecialized "CN1")}}selected{{/if}}>CN1</option>
      <option value="CN2" {{#if (eq selectedSpecialized "CN2")}}selected{{/if}}>CN2</option>
    </select>

    <!-- Tr√¨nh ƒë·ªô -->
    <label for="degree">Tr√¨nh ƒë·ªô:</label>
    <select name="degree" id="degree" onchange="this.form.submit()">
      <option value="all" {{#if (eq selectedDegree "all")}}selected{{/if}}>T·∫•t c·∫£</option>
      <option value="None" {{#if (eq selectedDegree "None")}}selected{{/if}}>Kh√¥ng</option>
      <option value="Master" {{#if (eq selectedDegree "Master")}}selected{{/if}}>Th·∫°c sƒ©</option>
      <option value="Associate Professor" {{#if (eq selectedDegree "Associate Professor")}}selected{{/if}}>Ph√≥ Gi√°o s∆∞</option>
      <option value="Professor" {{#if (eq selectedDegree "Professor")}}selected{{/if}}>Gi√°o s∆∞</option>
    </select>

    <!-- Lo·∫°i sinh vi√™n -->
    <label for="typeStudent">Lo·∫°i sinh vi√™n:</label>
    <select name="typeStudent" id="typeStudent" onchange="this.form.submit()">
      <option value="all" {{#if (eq selectedTypeStudent "all")}}selected{{/if}}>T·∫•t c·∫£</option>
      <option value="Qu·ªëc t·∫ø" {{#if (eq selectedTypeStudent "Qu·ªëc t·∫ø")}}selected{{/if}}>Qu·ªëc t·∫ø</option>
      <option value="Qu·ªëc n·ªôi" {{#if (eq selectedTypeStudent "Qu·ªëc n·ªôi")}}selected{{/if}}>Qu·ªëc n·ªôi</option>
    </select>

  {{/if}}
  {{#if (eq selectedMode "room")}}
  <h4>Th·ªëng k√™ c∆° s·ªü v·∫≠t ch·∫•t</h4>
  <form method="GET" action="/statis/auto">
    <input type="hidden" name="mode" value="room" />
    <label for="roomStatus">Ch·ªçn tr·∫°ng th√°i ph√≤ng:</label>
    <select name="roomStatus" id="roomStatus" onchange="this.form.submit()">
      <option value="all" {{#if (eq selectedRoomStatus 'all')}}selected{{/if}}>T·∫•t c·∫£</option>
      {{#each allStatuses}}
        <option value="{{this}}" {{#if (eq ../selectedRoomStatus this)}}selected{{/if}}>{{this}}</option>
      {{/each}}
    </select>
  </form>
  
  <p>
    {{#if (eq selectedRoomStatus "all")}}
      T·ªïng s·ªë ph√≤ng (m·ªçi tr·∫°ng th√°i): {{totalRooms}}
    {{else}}
      T·ªïng s·ªë ph√≤ng c√≥ tr·∫°ng th√°i "{{selectedRoomStatus}}": {{totalRooms}}
    {{/if}}
  </p>
{{/if}}


</form>
{{#if (eq selectedMode "candidate")}}
  <p>T·ªïng s·ªë ·ª©ng vi√™n: <strong>{{totalCandidates}}</strong></p>
{{else if (eq selectedMode "room")}}
  <p>T·ªïng s·ªë ph√≤ng: <strong>{{totalRooms}}</strong></p>
{{else}}
  <p>T·ªïng s·ªë s·ª± ki·ªán: <strong>{{totalEvents}}</strong></p>
{{/if}}
 --}}
<!-- Ph·∫ßn ch·ªçn mode (d√πng chung cho c·∫£ 3) -->
<form method="GET" action="/statis/auto">
  <label for="mode">Ph√¢n lo·∫°i:</label>
  <select name="mode" id="mode" onchange="this.form.submit()">
    <option value="candidate" {{#if (eq selectedMode "candidate")}}selected{{/if}}>Th·ªëng k√™ ·ª©ng vi√™n</option>
    <option value="event" {{#if (eq selectedMode "event")}}selected{{/if}}>Th·ªëng k√™ s·ª± ki·ªán</option>
    <option value="room" {{#if (eq selectedMode "room")}}selected{{/if}}>Th·ªëng k√™ c∆° s·ªü v·∫≠t ch·∫•t</option>
    <option value="equipment" {{#if (eq selectedMode "equipment")}}selected{{/if}}>Th·ªëng k√™ thi·∫øt b·ªã</option>
  </select>
  
</form>

<hr>

{{!-- ================== CANDIDATE MODE ================== --}}
{{#if (eq selectedMode "candidate")}}
<form method="GET" action="/statis/auto">
  <input type="hidden" name="mode" value="candidate" />

  <label for="year">NƒÉm:</label>
  <select name="year" id="year" onchange="this.form.submit()">
    <option value="all" {{#if (eq selectedYear "all")}}selected{{/if}}>T·∫•t c·∫£</option>
    {{#each availableYears}}
      <option value="{{this}}" {{#if (eq this ../selectedYear)}}selected{{/if}}>{{this}}</option>
    {{/each}}
  </select>

  <label for="type">Lo·∫°i s·ª± ki·ªán:</label>
  <select name="type" id="type" onchange="this.form.submit()">
    <option value="all" {{#if (eq selectedType "all")}}selected{{/if}}>T·∫•t c·∫£</option>
    {{#each types}}
      <option value="{{this._id}}" {{#if (eq this._id ../selectedType)}}selected{{/if}}>{{this.name}}</option>
    {{/each}}
  </select>

  <label for="classify">Lo·∫°i th√†nh vi√™n:</label>
  <select name="classify" id="classify" onchange="this.form.submit()">
    <option value="all" {{#if (eq selectedClassify "all")}}selected{{/if}}>T·∫•t c·∫£</option>
    <option value="·ª®ng vi√™n" {{#if (eq selectedClassify "·ª®ng vi√™n")}}selected{{/if}}>·ª®ng vi√™n</option>
    <option value="Ban qu·∫£n l√Ω" {{#if (eq selectedClassify "Ban qu·∫£n l√Ω")}}selected{{/if}}>Ban qu·∫£n l√Ω</option>
  </select>

  <label for="specialized">Chuy√™n ng√†nh:</label>
  <select name="specialized" id="specialized" onchange="this.form.submit()">
    <option value="all" {{#if (eq selectedSpecialized "all")}}selected{{/if}}>T·∫•t c·∫£</option>
    <option value="CN1" {{#if (eq selectedSpecialized "CN1")}}selected{{/if}}>CN1</option>
    <option value="CN2" {{#if (eq selectedSpecialized "CN2")}}selected{{/if}}>CN2</option>
  </select>

  <label for="degree">Tr√¨nh ƒë·ªô:</label>
  <select name="degree" id="degree" onchange="this.form.submit()">
    <option value="all" {{#if (eq selectedDegree "all")}}selected{{/if}}>T·∫•t c·∫£</option>
    <option value="None" {{#if (eq selectedDegree "None")}}selected{{/if}}>Kh√¥ng</option>
    <option value="Master" {{#if (eq selectedDegree "Master")}}selected{{/if}}>Th·∫°c sƒ©</option>
    <option value="Associate Professor" {{#if (eq selectedDegree "Associate Professor")}}selected{{/if}}>Ph√≥ Gi√°o s∆∞</option>
    <option value="Professor" {{#if (eq selectedDegree "Professor")}}selected{{/if}}>Gi√°o s∆∞</option>
  </select>

  <label for="typeStudent">Lo·∫°i sinh vi√™n:</label>
  <select name="typeStudent" id="typeStudent" onchange="this.form.submit()">
    <option value="all" {{#if (eq selectedTypeStudent "all")}}selected{{/if}}>T·∫•t c·∫£</option>
    <option value="Qu·ªëc t·∫ø" {{#if (eq selectedTypeStudent "Qu·ªëc t·∫ø")}}selected{{/if}}>Qu·ªëc t·∫ø</option>
    <option value="Qu·ªëc n·ªôi" {{#if (eq selectedTypeStudent "Qu·ªëc n·ªôi")}}selected{{/if}}>Qu·ªëc n·ªôi</option>
  </select>
</form>

<p>T·ªïng s·ªë ·ª©ng vi√™n: <strong>{{totalCandidates}}</strong></p>
{{/if}}

{{!-- ================== EVENT MODE ================== --}}
{{#if (eq selectedMode "event")}}
<form method="GET" action="/statis/auto">
  <input type="hidden" name="mode" value="event" />

  <label for="year">NƒÉm:</label>
  <select name="year" id="year" onchange="this.form.submit()">
    <option value="all" {{#if (eq selectedYear "all")}}selected{{/if}}>T·∫•t c·∫£</option>
    {{#each availableYears}}
      <option value="{{this}}" {{#if (eq this ../selectedYear)}}selected{{/if}}>{{this}}</option>
    {{/each}}
  </select>

  <label for="type">Lo·∫°i s·ª± ki·ªán:</label>
  <select name="type" id="type" onchange="this.form.submit()">
    <option value="all" {{#if (eq selectedType "all")}}selected{{/if}}>T·∫•t c·∫£</option>
    {{#each types}}
      <option value="{{this._id}}" {{#if (eq this._id ../selectedType)}}selected{{/if}}>{{this.name}}</option>
    {{/each}}
  </select>

  <label for="eventType">Lo·∫°i s·ª± ki·ªán:</label>
  <select name="eventType" id="eventType" onchange="this.form.submit()">
    <option value="all" {{#if (eq selectedEventType "all")}}selected{{/if}}>T·∫•t c·∫£</option>
    <option value="Trong n∆∞·ªõc" {{#if (eq selectedEventType "Trong n∆∞·ªõc")}}selected{{/if}}>Trong n∆∞·ªõc</option>
    <option value="Ngo√†i n∆∞·ªõc" {{#if (eq selectedEventType "Ngo√†i n∆∞·ªõc")}}selected{{/if}}>Ngo√†i n∆∞·ªõc</option>
  </select>

  <label for="courseLanguage">Ng√¥n ng·ªØ:</label>
  <select name="courseLanguage" id="courseLanguage" onchange="this.form.submit()">
    <option value="all" {{#if (eq selectedCourseLanguage "all")}}selected{{/if}}>T·∫•t c·∫£</option>
    <option value="Anh" {{#if (eq selectedCourseLanguage "Anh")}}selected{{/if}}>Anh</option>
    <option value="H√†n Qu·ªëc" {{#if (eq selectedCourseLanguage "H√†n Qu·ªëc")}}selected{{/if}}>H√†n Qu·ªëc</option>
  </select>

  <label for="status">Tr·∫°ng th√°i:</label>
  <select name="status" id="status" onchange="this.form.submit()">
    <option value="all" {{#if (eq selectedStatus "all")}}selected{{/if}}>T·∫•t c·∫£</option>
    <option value="ƒê√£ xu·∫•t b·∫£n" {{#if (eq selectedStatus "ƒê√£ xu·∫•t b·∫£n")}}selected{{/if}}>ƒê√£ xu·∫•t b·∫£n</option>
    <option value="ƒêang th·ª±c hi·ªán" {{#if (eq selectedStatus "ƒêang th·ª±c hi·ªán")}}selected{{/if}}>ƒêang th·ª±c hi·ªán</option>
  </select>
</form>

<p>T·ªïng s·ªë s·ª± ki·ªán: <strong>{{totalEvents}}</strong></p>
{{/if}}

{{!-- ================== ROOM MODE ================== --}}
{{#if (eq selectedMode "room")}}
<h4>Th·ªëng k√™ c∆° s·ªü v·∫≠t ch·∫•t</h4>
<form method="GET" action="/statis/auto">
  <input type="hidden" name="mode" value="room" />

    <label for="year">Ch·ªçn nƒÉm:</label>
    <select name="year" id="year" onchange="this.form.submit()">
      <option value="all" {{#if (eq selectedYear 'all')}}selected{{/if}}>T·∫•t c·∫£</option>
      {{#each availableYearsR}}
        <option value="{{this}}" {{#if (eq ../selectedYear this)}}selected{{/if}}>{{this}}</option>
      {{/each}}
    </select>

  <label for="roomStatus">Ch·ªçn tr·∫°ng th√°i ph√≤ng:</label>
  <select name="roomStatus" id="roomStatus" onchange="this.form.submit()">
    <option value="all" {{#if (eq selectedRoomStatus 'all')}}selected{{/if}}>T·∫•t c·∫£</option>
    {{#each allStatuses}}
      <option value="{{this}}" {{#if (eq ../selectedRoomStatus this)}}selected{{/if}}>{{this}}</option>
    {{/each}}
  </select>

</form>

<p>
  {{#if (eq selectedRoomStatus "all")}}
    T·ªïng s·ªë ph√≤ng (m·ªçi tr·∫°ng th√°i): {{totalRooms}}
  {{else}}
    T·ªïng s·ªë ph√≤ng c√≥ tr·∫°ng th√°i "{{selectedRoomStatus}}": {{totalRooms}}
  {{/if}}
</p>
{{/if}}

{{!-- ================== EQUIPMENT MODE ================== --}}
{{#if (eq selectedMode "equipment")}}
  <h4>Th·ªëng k√™ thi·∫øt b·ªã theo tr·∫°ng th√°i ph√≤ng</h4>

  <form method="GET">
    <input type="hidden" name="mode" value="equipment" />
    <label for="year">Ch·ªçn nƒÉm:</label>
    <select name="year" id="year" onchange="this.form.submit()">
      <option value="all" {{#if (eq selectedYear 'all')}}selected{{/if}}>T·∫•t c·∫£</option>
      {{#each availableYearsR}}
        <option value="{{this}}" {{#if (eq ../selectedYear this)}}selected{{/if}}>{{this}}</option>
      {{/each}}
    </select>



    <label for="roomStatus">Ch·ªçn tr·∫°ng th√°i ph√≤ng:</label>
    <select name="roomStatus" id="roomStatus" onchange="this.form.submit()">
      <option value="all" {{#if (eq selectedRoomStatus 'all')}}selected{{/if}}>T·∫•t c·∫£</option>
      {{#each allStatuses}}
        <option value="{{this}}" {{#if (eq ../selectedRoomStatus this)}}selected{{/if}}>{{this}}</option>
      {{/each}}
    </select>
  </form>

  <p>
    {{#if (eq selectedRoomStatus "all")}}
      T·ªïng s·ªë thi·∫øt b·ªã t·ª´ m·ªçi ph√≤ng: <strong>{{totalEquipment}}</strong>
    {{else}}
      T·ªïng s·ªë thi·∫øt b·ªã trong ph√≤ng tr·∫°ng th√°i "{{selectedRoomStatus}}": <strong>{{totalEquipment}}</strong>
    {{/if}}
  </p>

{{/if}}





<form id="subForm" method="POST" action="/statis/store">
  <input type="hidden" name="mode" value="{{selectedMode}}">
  <table class="table table-bordered">
  <thead class="table-dark">
    <tr>
      <th></th>
      <th>NƒÉm</th>
      <th>Ho·∫°t ƒë·ªông</th>
      <th>S·ªë li·ªáu</th>
      <th>Gi√° tr·ªã</th>
      <th>ƒê∆°n v·ªã</th>
      <th>H√†nh ƒë·ªông</th>
    </tr>
  </thead>
  <tr>
    <td></td>
    <td><input type="text" class="form-control" name="nam" value="{{ selectedYear }}"></td>
    <td><input type="text" class="form-control" name="hoat_dong"></td>
    <td>
      <div id="formVi">
        <div class="mb-3">
          <input type="text" class="form-control" name="vi_chi_so" id="vi_chi_so"
            value="{{#if (eq selectedMode 'event')}}S·ª± ki·ªán
                  {{else if (eq selectedClassify 'all')}}Ng∆∞·ªùi tham gia
                  {{else}}{{selectedClassify}}{{/if}}">
        </div>
      </div>

      <div id="formEn" style="display: none;">
        <div class="mb-3">
          <input type="text" name="en_chi_so" id="en_chi_so" class="form-control">
        </div>
      </div>
      {{!-- <input type="text" class="form-control" name="chi_so" 
        value="{{#if (eq selectedMode 'event')}}S·ª± ki·ªán
              {{else if (eq selectedClassify 'all')}}Ng∆∞·ªùi tham gia
              {{else}}{{selectedClassify}}{{/if}}"> --}}
    </td>
    <td><input type="number" class="form-control" name="gia_tri" value="{{totalCandidates}}{{totalEvents}}"></td>
    <td>
      <div id="formVi">
        <div class="mb-3">
          <input type="text" class="form-control" name="vi_don_vi" id="vi_don_vi"
            value="{{#if (eq selectedMode 'event')}}S·ª± ki·ªán
                  {{else if (eq selectedClassify 'all')}}Ng∆∞·ªùi tham gia
                  {{else}}{{selectedClassify}}{{/if}}">
        </div>
      </div>

      <div id="formEn" style="display: none;">
        <div class="mb-3">
          <input type="text" name="en_don_vi" id="en_don_vi" class="form-control">
        </div>
      </div>
      {{!-- <input type="text" class="form-control" name="don_vi"> --}}
    </td>
    <input type="hidden" id="vi_en_json" name="vi_en_json">
    <td><button type="submit" class="btn btn-primary">L∆∞u th·ªëng k√™</button></td>
  </tr>
</table>
</form>

<script>
document.addEventListener("DOMContentLoaded", function() {
    // üîÅ Mapping gi√° tr·ªã ti·∫øng Vi·ªát sang ti·∫øng Anh cho en_chi_so
    const classifyMap = {
    "S·ª± ki·ªán": "Event",
    "Ng∆∞·ªùi tham gia": "Participants",
    "·ª®ng vi√™n": "Candidate",
    "Ban qu·∫£n l√Ω": "Management"
  };

  function bindViToEn(viSelector, enSelector) {
    const viInput = document.querySelector(viSelector);
    const enInput = document.querySelector(enSelector);

    if (viInput && enInput) {
      const viValue = viInput.value.trim();
      enInput.value = classifyMap[viValue] || "";

      viInput.addEventListener("input", () => {
        const newVal = viInput.value.trim();
        enInput.value = classifyMap[newVal] || "";
      });
    }
  }

  // G·∫Øn cho t·ª´ng c·∫∑p
  bindViToEn('input[name="vi_chi_so"]', 'input[name="en_chi_so"]');
  bindViToEn('input[name="vi_don_vi"]', 'input[name="en_don_vi"]');

    document.getElementById("subForm").addEventListener("submit", function(event) {
          event.preventDefault();
          const viCH = document.getElementById("vi_chi_so").value.trim();
          const enCH = document.getElementById("en_chi_so").value.trim();
          const viDV = document.getElementById("vi_don_vi").value.trim();
          const enDV = document.getElementById("en_don_vi").value.trim();
          const data = { 
            vi: { chi_so: viCH, don_vi:viDV }, 
            en: { chi_so: enCH, don_vi:enDV } 
            };
          document.getElementById("vi_en_json").value = JSON.stringify(data);
          this.submit();
    });
});

  const saveInputs = () => {
    localStorage.setItem("hoat_dong", document.querySelector('input[name="hoat_dong"]').value);
  };

  const restoreInputs = () => {
    if (localStorage.getItem("hoat_dong"))
      document.querySelector('input[name="hoat_dong"]').value = localStorage.getItem("hoat_dong");
  };

  window.addEventListener('beforeunload', saveInputs);
  window.addEventListener('DOMContentLoaded', restoreInputs);

</script>
